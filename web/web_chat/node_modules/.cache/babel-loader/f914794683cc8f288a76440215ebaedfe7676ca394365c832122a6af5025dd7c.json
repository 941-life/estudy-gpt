{"ast":null,"code":"import _objectSpread from\"/home/kmean/Desktop/Mobile/term_project/estudy_gpt/web/web_chat/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// import React, { useRef, useEffect, useState } from \"react\";\n// import styles from \"../styles/ChatRoom.module.css\";\n// import {\n//   fetchGeminiReply,\n//   initializeChatSession,\n//   clearChatSession,\n//   getConversationHistory,\n// } from \"../api/gemini\";\n// import { saveChat, updateChatAnalysis, initializeAuth } from \"../api/firebase\";\n// import ScenarioSelector from \"./ScenarioSelector\";\n// import AnalysisModal from \"./AnalysisModal\";\n// import { auth, db } from \"../firebase/firebaseConfig\";\n// import { get, ref, update } from \"firebase/database\";\n// const CEFR_CRITERIA = {\n//   A1: {\n//     score: [0, 30],\n//     criteria: [\n//       \"Can use basic vocabulary and simple phrases\",\n//       \"Can understand and use familiar everyday expressions\",\n//       \"Can introduce themselves and others\",\n//       \"Can ask and answer simple questions about personal details\",\n//     ],\n//   },\n//   A2: {\n//     score: [31, 50],\n//     criteria: [\n//       \"Can communicate in simple and routine tasks\",\n//       \"Can describe in simple terms aspects of their background\",\n//       \"Can handle short social exchanges\",\n//       \"Can understand sentences and frequently used expressions\",\n//     ],\n//   },\n//   B1: {\n//     score: [51, 70],\n//     criteria: [\n//       \"Can deal with most situations likely to arise while traveling\",\n//       \"Can produce simple connected text on familiar topics\",\n//       \"Can describe experiences, events, dreams, and ambitions\",\n//       \"Can give reasons and explanations for opinions and plans\",\n//     ],\n//   },\n//   B2: {\n//     score: [71, 85],\n//     criteria: [\n//       \"Can interact with a degree of fluency and spontaneity\",\n//       \"Can produce clear, detailed text on a wide range of subjects\",\n//       \"Can explain a viewpoint on a topical issue\",\n//       \"Can understand the main ideas of complex text\",\n//     ],\n//   },\n//   C1: {\n//     score: [86, 95],\n//     criteria: [\n//       \"Can express ideas fluently and spontaneously\",\n//       \"Can use language flexibly and effectively for social and professional purposes\",\n//       \"Can produce clear, well-structured, detailed text on complex subjects\",\n//       \"Can understand implicit meaning\",\n//     ],\n//   },\n//   C2: {\n//     score: [96, 100],\n//     criteria: [\n//       \"Can understand with ease virtually everything heard or read\",\n//       \"Can summarize information from different sources\",\n//       \"Can express themselves spontaneously, very fluently and precisely\",\n//       \"Can differentiate finer shades of meaning\",\n//     ],\n//   },\n// };\n// const LEVEL_ADJUSTMENTS = {\n//   A1: {\n//     vocab: \"basic (up to 500 words)\",\n//     grammar: \"simple present tense and basic present continuous\",\n//     sentenceLength: \"5-7 words\",\n//     focus: \"concrete, everyday topics\",\n//   },\n//   A2: {\n//     vocab: \"basic (up to 1000 words)\",\n//     grammar: \"simple past and future tenses\",\n//     sentenceLength: \"7-10 words\",\n//     focus: \"familiar topics and daily routines\",\n//   },\n//   B1: {\n//     vocab: \"intermediate (up to 2000 words)\",\n//     grammar: \"various tenses and modal verbs\",\n//     sentenceLength: \"10-15 words\",\n//     focus: \"abstract topics and opinions\",\n//   },\n//   B2: {\n//     vocab: \"advanced (up to 4000 words)\",\n//     grammar: \"complex grammar structures\",\n//     sentenceLength: \"15-20 words\",\n//     focus: \"complex topics and hypothetical situations\",\n//   },\n//   C1: {\n//     vocab: \"sophisticated (up to 8000 words)\",\n//     grammar: \"advanced grammar structures\",\n//     sentenceLength: \"20+ words\",\n//     focus: \"abstract concepts and specialized topics\",\n//   },\n//   C2: {\n//     vocab: \"native-like expressions\",\n//     grammar: \"complex grammar naturally\",\n//     sentenceLength: \"natural length\",\n//     focus: \"any topic with depth and precision\",\n//   },\n// };\n// function ChatRoom({ character, onBack }) {\n//   const [messages, setMessages] = useState([]);\n//   const [input, setInput] = useState(\"\");\n//   const [loading, setLoading] = useState(false);\n//   const [selectedScenario, setSelectedScenario] = useState(null);\n//   const [chatId, setChatId] = useState(null);\n//   const [isCompleting, setIsCompleting] = useState(false);\n//   const [showAnalysis, setShowAnalysis] = useState(false);\n//   const [analysis, setAnalysis] = useState(null);\n//   const [userLevel, setUserLevel] = useState(\"A1\");\n//   const [isAuthReady, setIsAuthReady] = useState(false);\n//   const chatEndRef = useRef(null);\n//   const inputRef = useRef(null);\n//   useEffect(() => {\n//     const unsubscribe = auth.onAuthStateChanged((user) => {\n//       setIsAuthReady(!!user);\n//       if (user) {\n//         initUserData();\n//       }\n//     });\n//     return () => unsubscribe();\n//   }, []);\n//   const initUserData = async () => {\n//     try {\n//       if (!auth.currentUser) return;\n//       const uid = auth.currentUser.uid;\n//       const userRef = ref(db, `users/${uid}`);\n//       const snapshot = await get(userRef);\n//       if (snapshot.exists()) {\n//         const userData = snapshot.val();\n//         if (userData.cefrLevel) {\n//           setUserLevel(userData.cefrLevel);\n//         }\n//       }\n//     } catch (error) {\n//       console.error(\"사용자 데이터 초기화 중 오류:\", error);\n//     }\n//   };\n//   const removeMarkdown = (text) => {\n//     return text\n//       .replace(/\\*\\*(.*?)\\*\\*/g, \"$1\")\n//       .replace(/\\*(.*?)\\*/g, \"$1\")\n//       .replace(/_(.*?)_/g, \"$1\")\n//       .replace(/`(.*?)`/g, \"$1\")\n//       .replace(/\\[(.*?)\\]\\((.*?)\\)/g, \"$1\")\n//       .replace(/\\n/g, \" \")\n//       .replace(/\\s+/g, \" \")\n//       .trim();\n//   };\n//   useEffect(() => {\n//     chatEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n//   }, [messages]);\n//   useEffect(() => {\n//     if (!loading && inputRef.current) {\n//       inputRef.current.focus();\n//     }\n//   }, [loading, messages]);\n//   const getLevelAdjustedPrompt = (basePrompt) => {\n//     const level = LEVEL_ADJUSTMENTS[userLevel];\n//     return `${basePrompt}\\n\\nIMPORTANT: Stay in character while following these guidelines:\n// 1. CHARACTER:\n// - Maintain your personality traits and speech patterns\n// - Use your characteristic expressions\n// - Stay consistent with your character's style\n// 2. CONVERSATION:\n// - Ask 2-3 follow-up questions per topic\n// - Use questions matching your character's interests\n// - Show curiosity in topics that fit your personality\n// - Ask for details in your character's way\n// 3. LANGUAGE (CEFR ${userLevel}):\n// - Use ${level.vocab}\n// - Use ${level.grammar}\n// - Keep sentences ${level.sentenceLength}\n// - Focus on ${level.focus}\n// 4. TOPICS:\n// - Discuss topics your character cares about\n// - Share your character's perspective\n// - Ask questions reflecting your character's interests\n// - Build on responses while staying in character\n// 5. CORRECTIONS:\n// - Focus on major errors only\n// - Rephrase mistakes while staying in character\n// - Keep the conversation natural\n// Goal: Maintain character while helping practice English.`;\n//   };\n//   useEffect(() => {\n//     if (selectedScenario) {\n//       const adjustedPrompt = getLevelAdjustedPrompt(selectedScenario.prompt);\n//       initializeChatSession(character.id, adjustedPrompt).catch((err) => {\n//         console.error(\"Failed to initialize chat session:\", err);\n//         setMessages((msgs) => [\n//           ...msgs,\n//           {\n//             from: \"other\",\n//             text: \"채팅 세션을 시작하지 못했어요. 다시 시도해주세요.\",\n//           },\n//         ]);\n//       });\n//     }\n//   }, [selectedScenario, character.id, userLevel]);\n//   useEffect(() => {\n//     return () => {\n//       if (character.id) {\n//         clearChatSession(character.id);\n//       }\n//     };\n//   }, [character.id]);\n//   const analyzeChat = async (messages) => {\n//     try {\n//       const userMessages = messages\n//         .filter((msg) => msg.role === \"user\")\n//         .map((msg) => msg.content);\n//       const uid = auth.currentUser.uid;\n//       const userRef = ref(db, `users/${uid}`);\n//       const snapshot = await get(userRef);\n//       const currentLevel = snapshot.exists() ? snapshot.val().cefrLevel : \"A1\";\n//       const prompt = `You are a friendly English conversation partner analyzing a casual chat. Your role is to evaluate the user's English and provide constructive feedback.\n//       IMPORTANT GUIDELINES FOR ERROR CORRECTION:\n//       - DO NOT correct casual expressions like \"plz\", \"thx\", \"gonna\", \"wanna\", etc.\n//       - DO NOT mark missing periods or casual capitalization as errors\n//       - DO NOT correct common chat abbreviations or emoticons\n//       - DO NOT correct informal/conversational grammar that native speakers commonly use\n//       - Only correct clear mistakes that affect understanding or are definitely wrong\n//       - Focus on helping them communicate more naturally, not on strict grammar rules\n//       IMPORTANT: Respond ONLY with valid JSON, no other text.\n//       Format your response exactly like this:\n//       {\n//         \"corrections\": [\n//           {\n//             \"original\": \"original sentence\",\n//             \"corrected\": \"corrected sentence\",\n//             \"explanation\": \"friendly explanation focusing on natural communication (2 lines max)\"\n//           }\n//         ],\n//         \"summary\": \"encouraging feedback about their communication style and specific areas for improvement (2-3 lines)\"\n//       }\n//       Analyze these messages:\n//       ${JSON.stringify(userMessages, null, 2)}`;\n//       const response = await fetchGeminiReply(prompt, character.id);\n//       const responseText = await response.text();\n//       try {\n//         const jsonMatch = responseText.match(/\\{[\\s\\S]*\\}/);\n//         if (!jsonMatch) {\n//           throw new Error(\"No JSON found in response\");\n//         }\n//         const parsedAnalysis = JSON.parse(jsonMatch[0]);\n//         if (\n//           !parsedAnalysis.corrections ||\n//           !Array.isArray(parsedAnalysis.corrections)\n//         ) {\n//           throw new Error(\"Invalid corrections format\");\n//         }\n//         if (\n//           !parsedAnalysis.summary ||\n//           typeof parsedAnalysis.summary !== \"string\"\n//         ) {\n//           throw new Error(\"Invalid summary format\");\n//         }\n//         const correctionCount = parsedAnalysis.corrections.length;\n//         const score = Math.max(0, 100 - correctionCount * 10);\n//         const newLevel = await checkAndUpdateCEFRLevel(score);\n//         return {\n//           ...parsedAnalysis,\n//           score,\n//           previousCefrLevel: currentLevel,\n//           newCefrLevel: newLevel,\n//         };\n//       } catch (e) {\n//         console.error(\"Failed to parse analysis response:\", e);\n//         return {\n//           corrections: [],\n//           summary: \"분석 결과를 파싱하는데 실패했습니다. 다시 시도해주세요.\",\n//           score: 0,\n//           previousCefrLevel: currentLevel,\n//           newCefrLevel: currentLevel,\n//         };\n//       }\n//     } catch (error) {\n//       console.error(\"Error analyzing chat:\", error);\n//       throw error;\n//     }\n//   };\n//   const checkAndUpdateCEFRLevel = async (score) => {\n//     try {\n//       const uid = auth.currentUser.uid;\n//       const userRef = ref(db, `users/${uid}`);\n//       const snapshot = await get(userRef);\n//       if (!snapshot.exists()) return \"A1\";\n//       const userData = snapshot.val();\n//       const recentScores = userData.recentScores || [];\n//       const totalSessions = userData.totalSessions || 0;\n//       recentScores.push({\n//         score,\n//         timestamp: Date.now(),\n//       });\n//       if (recentScores.length > 10) {\n//         recentScores.shift();\n//       }\n//       let newLevel = userData.cefrLevel;\n//       const isInitialStage = totalSessions < 20;\n//       if (isInitialStage) {\n//         if (userData.cefrLevel === \"A1\") {\n//           const highScores = recentScores.filter((s) => s.score >= 60);\n//           if (highScores.length >= 2) {\n//             newLevel = \"A2\";\n//           }\n//         } else {\n//           const highScores = recentScores.filter((s) => s.score >= 90);\n//           if (highScores.length >= 9) {\n//             newLevel = getNextLevel(userData.cefrLevel);\n//           }\n//           const lowScores = recentScores.filter((s) => s.score <= 50);\n//           if (lowScores.length >= 6) {\n//             newLevel = getPreviousLevel(userData.cefrLevel);\n//           }\n//         }\n//       } else {\n//         const highScores = recentScores.filter((s) => s.score >= 80);\n//         if (highScores.length >= 4) {\n//           newLevel = getNextLevel(userData.cefrLevel);\n//         }\n//         const lowScores = recentScores.filter((s) => s.score <= 60);\n//         if (lowScores.length >= 3) {\n//           newLevel = getPreviousLevel(userData.cefrLevel);\n//         }\n//       }\n//       if (newLevel !== userData.cefrLevel) {\n//         await update(userRef, {\n//           cefrLevel: newLevel,\n//           recentScores,\n//           totalSessions: totalSessions + 1,\n//           levelHistory: [\n//             ...(userData.levelHistory || []),\n//             {\n//               level: newLevel,\n//               changedAt: Date.now(),\n//               reason: newLevel > userData.cefrLevel ? \"upgrade\" : \"downgrade\",\n//             },\n//           ],\n//         });\n//       } else {\n//         await update(userRef, {\n//           recentScores,\n//           totalSessions: totalSessions + 1,\n//         });\n//       }\n//       return newLevel;\n//     } catch (error) {\n//       console.error(\"Error updating CEFR level:\", error);\n//       return \"A1\";\n//     }\n//   };\n//   const getNextLevel = (currentLevel) => {\n//     const levels = [\"A1\", \"A2\", \"B1\", \"B2\", \"C1\", \"C2\"];\n//     const currentIndex = levels.indexOf(currentLevel);\n//     return currentIndex < levels.length - 1\n//       ? levels[currentIndex + 1]\n//       : currentLevel;\n//   };\n//   const getPreviousLevel = (currentLevel) => {\n//     const levels = [\"A1\", \"A2\", \"B1\", \"B2\", \"C1\", \"C2\"];\n//     const currentIndex = levels.indexOf(currentLevel);\n//     return currentIndex > 0 ? levels[currentIndex - 1] : currentLevel;\n//   };\n//   const handleSendMessage = async (message) => {\n//     if (!message.trim() || !isAuthReady || !auth.currentUser) return;\n//     const newMessage = {\n//       role: \"user\",\n//       content: message,\n//       timestamp: new Date(),\n//     };\n//     setMessages((prev) => [...prev, newMessage]);\n//     setInput(\"\");\n//     setLoading(true);\n//     try {\n//       if (!chatId) {\n//         const newChatId = await saveChat(message, character.id);\n//         setChatId(newChatId);\n//       }\n//       const response = await fetchGeminiReply(message, character.id);\n//       const responseText = await response.text();\n//       const cleanResponse = removeMarkdown(responseText);\n//       const aiMessage = {\n//         role: \"assistant\",\n//         content: cleanResponse,\n//         timestamp: new Date(),\n//       };\n//       setMessages((prev) => [...prev, aiMessage]);\n//     } catch (error) {\n//       console.error(\"AI 응답 생성 중 오류:\", error);\n//       setMessages((prev) => [\n//         ...prev,\n//         {\n//           role: \"assistant\",\n//           content:\n//             \"죄송합니다. 응답을 생성하는 중에 오류가 발생했습니다. 잠시 후 다시 시도해주세요.\",\n//           timestamp: new Date(),\n//         },\n//       ]);\n//     } finally {\n//       setLoading(false);\n//     }\n//   };\n//   const handleFinishChat = async () => {\n//     if (!chatId) return;\n//     setIsCompleting(true);\n//     try {\n//       const analysis = await analyzeChat(messages);\n//       setAnalysis(analysis);\n//       setShowAnalysis(true);\n//       try {\n//         await updateChatAnalysis(chatId, {\n//           ...analysis,\n//           messages: messages\n//             .filter((msg) => msg.role === \"user\")\n//             .map((msg) => ({\n//               content: msg.content,\n//               timestamp: msg.timestamp,\n//             })),\n//         });\n//       } catch (error) {\n//         console.error(\"분석 결과 저장 중 오류:\", error);\n//       }\n//     } catch (error) {\n//       console.error(\"채팅 분석 중 오류:\", error);\n//       setMessages((prev) => [\n//         ...prev,\n//         {\n//           role: \"assistant\",\n//           content: \"채팅 분석 중 오류가 발생했습니다. 다시 시도해주세요.\",\n//           timestamp: new Date(),\n//         },\n//       ]);\n//     } finally {\n//       setIsCompleting(false);\n//     }\n//   };\n//   const handleKeyPress = (e) => {\n//     if (e.key === \"Enter\" && !e.shiftKey) {\n//       e.preventDefault();\n//       handleSendMessage(input);\n//     }\n//   };\n//   if (!isAuthReady) {\n//     return (\n//       <div className={styles.loadingContainer}>\n//         <div className={styles.loadingSpinner} />\n//       </div>\n//     );\n//   }\n//   if (!selectedScenario) {\n//     return (\n//       <ScenarioSelector onSelect={setSelectedScenario} character={character} />\n//     );\n//   }\n//   return (\n//     <div className={styles.root}>\n//       <div className={styles.header}>\n//         <button onClick={onBack} className={styles.backBtn}>\n//           ←\n//         </button>\n//         <img\n//           src={character.imageUrl}\n//           alt={character.name}\n//           className={styles.avatar}\n//         />\n//         <div className={styles.title}>{character.name}</div>\n//         <button\n//           onClick={handleFinishChat}\n//           className={`${styles.completeBtn} ${\n//             isCompleting ? styles.completing : \"\"\n//           }`}\n//           disabled={!chatId || isCompleting}\n//         >\n//           {isCompleting ? \"처리 중...\" : \"오답 노트\"}\n//         </button>\n//       </div>\n//       <div className={styles.messages}>\n//         {messages.map((msg, idx) => (\n//           <div\n//             key={idx}\n//             className={\n//               styles[\"bubble\" + (msg.role === \"user\" ? \"Me\" : \"Other\")]\n//             }\n//           >\n//             {msg.content}\n//           </div>\n//         ))}\n//         {loading && (\n//           <div className={styles.bubbleOther}>\n//             <div className={styles.typingIndicator}>\n//               <div className={styles.typingDot} />\n//               <div className={styles.typingDot} />\n//               <div className={styles.typingDot} />\n//             </div>\n//           </div>\n//         )}\n//         <div ref={chatEndRef} />\n//       </div>\n//       <div className={styles.inputbar}>\n//         <input\n//           ref={inputRef}\n//           id=\"chat-input\"\n//           name=\"chat-input\"\n//           value={input}\n//           onChange={(e) => setInput(e.target.value)}\n//           onKeyDown={handleKeyPress}\n//           placeholder=\"대화를 시작하세요.\"\n//           disabled={loading}\n//           autoComplete=\"off\"\n//         />\n//         <button\n//           onClick={() => handleSendMessage(input)}\n//           className={styles.sendBtn}\n//           disabled={loading || !input.trim()}\n//         >\n//           전송\n//         </button>\n//       </div>\n//       {showAnalysis && analysis && (\n//         <AnalysisModal\n//           analysis={analysis}\n//           onClose={() => setShowAnalysis(false)}\n//         />\n//       )}\n//     </div>\n//   );\n// }\n// export default ChatRoom;\nimport React,{useRef,useEffect,useState}from\"react\";import styles from\"../styles/ChatRoom.module.css\";import{fetchGeminiReply,initializeChatSession,clearChatSession,getConversationHistory}from\"../api/gemini\";import{saveChat,updateChatAnalysis}from\"../api/firebase\";import ScenarioSelector from\"./ScenarioSelector\";import AnalysisModal from\"./AnalysisModal\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CEFR_CRITERIA={A1:{score:[0,30],criteria:[\"Can use basic vocabulary and simple phrases\",\"Can understand and use familiar everyday expressions\",\"Can introduce themselves and others\",\"Can ask and answer simple questions about personal details\"]},A2:{score:[31,50],criteria:[\"Can communicate in simple and routine tasks\",\"Can describe in simple terms aspects of their background\",\"Can handle short social exchanges\",\"Can understand sentences and frequently used expressions\"]},B1:{score:[51,70],criteria:[\"Can deal with most situations likely to arise while traveling\",\"Can produce simple connected text on familiar topics\",\"Can describe experiences, events, dreams, and ambitions\",\"Can give reasons and explanations for opinions and plans\"]},B2:{score:[71,85],criteria:[\"Can interact with a degree of fluency and spontaneity\",\"Can produce clear, detailed text on a wide range of subjects\",\"Can explain a viewpoint on a topical issue\",\"Can understand the main ideas of complex text\"]},C1:{score:[86,95],criteria:[\"Can express ideas fluently and spontaneously\",\"Can use language flexibly and effectively for social and professional purposes\",\"Can produce clear, well-structured, detailed text on complex subjects\",\"Can understand implicit meaning\"]},C2:{score:[96,100],criteria:[\"Can understand with ease virtually everything heard or read\",\"Can summarize information from different sources\",\"Can express themselves spontaneously, very fluently and precisely\",\"Can differentiate finer shades of meaning\"]}};const LEVEL_ADJUSTMENTS={A1:{vocab:\"basic (up to 500 words)\",grammar:\"simple present tense and basic present continuous\",sentenceLength:\"5-7 words\",focus:\"concrete, everyday topics\"},A2:{vocab:\"basic (up to 1000 words)\",grammar:\"simple past and future tenses\",sentenceLength:\"7-10 words\",focus:\"familiar topics and daily routines\"},B1:{vocab:\"intermediate (up to 2000 words)\",grammar:\"various tenses and modal verbs\",sentenceLength:\"10-15 words\",focus:\"abstract topics and opinions\"},B2:{vocab:\"advanced (up to 4000 words)\",grammar:\"complex grammar structures\",sentenceLength:\"15-20 words\",focus:\"complex topics and hypothetical situations\"},C1:{vocab:\"sophisticated (up to 8000 words)\",grammar:\"advanced grammar structures\",sentenceLength:\"20+ words\",focus:\"abstract concepts and specialized topics\"},C2:{vocab:\"native-like expressions\",grammar:\"complex grammar naturally\",sentenceLength:\"natural length\",focus:\"any topic with depth and precision\"}};function ChatRoom(_ref){let{character,onBack}=_ref;const[messages,setMessages]=useState([]);const[input,setInput]=useState(\"\");const[loading,setLoading]=useState(false);const[selectedScenario,setSelectedScenario]=useState(null);const[chatId,setChatId]=useState(null);const[isCompleting,setIsCompleting]=useState(false);const[showAnalysis,setShowAnalysis]=useState(false);const[analysis,setAnalysis]=useState(null);const[userLevel,setUserLevel]=useState(\"A1\");const chatEndRef=useRef(null);const inputRef=useRef(null);// Firebase 인증 제거하고 기본 초기화\nuseEffect(()=>{initUserData();},[]);const initUserData=async()=>{try{// Flutter uid 기반으로 작동하므로 기본값 설정\nsetUserLevel(\"A1\");console.log(\"User data initialized with default level: A1\");}catch(error){console.error(\"사용자 데이터 초기화 중 오류:\",error);}};const removeMarkdown=text=>{return text.replace(/\\*\\*(.*?)\\*\\*/g,\"$1\").replace(/\\*(.*?)\\*/g,\"$1\").replace(/_(.*?)_/g,\"$1\").replace(/`(.*?)`/g,\"$1\").replace(/\\[(.*?)\\]\\((.*?)\\)/g,\"$1\").replace(/\\n/g,\" \").replace(/\\s+/g,\" \").trim();};useEffect(()=>{var _chatEndRef$current;(_chatEndRef$current=chatEndRef.current)===null||_chatEndRef$current===void 0?void 0:_chatEndRef$current.scrollIntoView({behavior:\"smooth\"});},[messages]);useEffect(()=>{if(!loading&&inputRef.current){inputRef.current.focus();}},[loading,messages]);const getLevelAdjustedPrompt=basePrompt=>{const level=LEVEL_ADJUSTMENTS[userLevel];return\"\".concat(basePrompt,\"\\n\\nIMPORTANT: Stay in character while following these guidelines:\\n\\n1. CHARACTER:\\n- Maintain your personality traits and speech patterns\\n- Use your characteristic expressions\\n- Stay consistent with your character's style\\n\\n2. CONVERSATION:\\n- Ask 2-3 follow-up questions per topic\\n- Use questions matching your character's interests\\n- Show curiosity in topics that fit your personality\\n- Ask for details in your character's way\\n\\n3. LANGUAGE (CEFR \").concat(userLevel,\"):\\n- Use \").concat(level.vocab,\"\\n- Use \").concat(level.grammar,\"\\n- Keep sentences \").concat(level.sentenceLength,\"\\n- Focus on \").concat(level.focus,\"\\n\\n4. TOPICS:\\n- Discuss topics your character cares about\\n- Share your character's perspective\\n- Ask questions reflecting your character's interests\\n- Build on responses while staying in character\\n\\n5. CORRECTIONS:\\n- Focus on major errors only\\n- Rephrase mistakes while staying in character\\n- Keep the conversation natural\\n\\nGoal: Maintain character while helping practice English.\");};useEffect(()=>{if(selectedScenario){const adjustedPrompt=getLevelAdjustedPrompt(selectedScenario.prompt);initializeChatSession(character.id,adjustedPrompt).catch(err=>{console.error(\"Failed to initialize chat session:\",err);setMessages(msgs=>[...msgs,{from:\"other\",text:\"채팅 세션을 시작하지 못했어요. 다시 시도해주세요.\"}]);});}},[selectedScenario,character.id,userLevel]);useEffect(()=>{return()=>{if(character.id){clearChatSession(character.id);}};},[character.id]);const analyzeChat=async messages=>{try{const userMessages=messages.filter(msg=>msg.role===\"user\").map(msg=>msg.content);// Firebase 사용자 데이터 조회 제거하고 기본값 사용\nconst currentLevel=userLevel||\"A1\";const prompt=\"You are a friendly English conversation partner analyzing a casual chat. Your role is to evaluate the user's English and provide constructive feedback.\\n\\n      IMPORTANT GUIDELINES FOR ERROR CORRECTION:\\n      - DO NOT correct casual expressions like \\\"plz\\\", \\\"thx\\\", \\\"gonna\\\", \\\"wanna\\\", etc.\\n      - DO NOT mark missing periods or casual capitalization as errors\\n      - DO NOT correct common chat abbreviations or emoticons\\n      - DO NOT correct informal/conversational grammar that native speakers commonly use\\n      - Only correct clear mistakes that affect understanding or are definitely wrong\\n      - Focus on helping them communicate more naturally, not on strict grammar rules\\n\\n      IMPORTANT: Respond ONLY with valid JSON, no other text.\\n      Format your response exactly like this:\\n      {\\n        \\\"corrections\\\": [\\n          {\\n            \\\"original\\\": \\\"original sentence\\\",\\n            \\\"corrected\\\": \\\"corrected sentence\\\",\\n            \\\"explanation\\\": \\\"friendly explanation focusing on natural communication (2 lines max)\\\"\\n          }\\n        ],\\n        \\\"summary\\\": \\\"encouraging feedback about their communication style and specific areas for improvement (2-3 lines)\\\"\\n      }\\n\\n      Analyze these messages:\\n      \".concat(JSON.stringify(userMessages,null,2));const response=await fetchGeminiReply(prompt,character.id);const responseText=await response.text();try{const jsonMatch=responseText.match(/\\{[\\s\\S]*\\}/);if(!jsonMatch){throw new Error(\"No JSON found in response\");}const parsedAnalysis=JSON.parse(jsonMatch[0]);if(!parsedAnalysis.corrections||!Array.isArray(parsedAnalysis.corrections)){throw new Error(\"Invalid corrections format\");}if(!parsedAnalysis.summary||typeof parsedAnalysis.summary!==\"string\"){throw new Error(\"Invalid summary format\");}const correctionCount=parsedAnalysis.corrections.length;const score=Math.max(0,100-correctionCount*10);return _objectSpread(_objectSpread({},parsedAnalysis),{},{score,previousCefrLevel:currentLevel,newCefrLevel:currentLevel// 레벨 업데이트 제거\n});}catch(e){console.error(\"Failed to parse analysis response:\",e);return{corrections:[],summary:\"분석 결과를 파싱하는데 실패했습니다. 다시 시도해주세요.\",score:0,previousCefrLevel:currentLevel,newCefrLevel:currentLevel};}}catch(error){console.error(\"Error analyzing chat:\",error);throw error;}};const handleSendMessage=async message=>{if(!message.trim())return;// Firebase 인증 체크 제거\nconst newMessage={role:\"user\",content:message,timestamp:new Date()};setMessages(prev=>[...prev,newMessage]);setInput(\"\");setLoading(true);try{// Flutter uid 기반으로 채팅 저장\nif(!chatId){const newChatId=await saveChat(message,character.id);setChatId(newChatId);}const response=await fetchGeminiReply(message,character.id);const responseText=await response.text();const cleanResponse=removeMarkdown(responseText);const aiMessage={role:\"assistant\",content:cleanResponse,timestamp:new Date()};setMessages(prev=>[...prev,aiMessage]);}catch(error){console.error(\"AI 응답 생성 중 오류:\",error);setMessages(prev=>[...prev,{role:\"assistant\",content:\"죄송합니다. 응답을 생성하는 중에 오류가 발생했습니다. 잠시 후 다시 시도해주세요.\",timestamp:new Date()}]);}finally{setLoading(false);}};const handleFinishChat=async()=>{if(!chatId)return;setIsCompleting(true);try{const analysis=await analyzeChat(messages);setAnalysis(analysis);setShowAnalysis(true);// Flutter uid 기반으로 분석 결과 저장\ntry{await updateChatAnalysis(chatId,_objectSpread(_objectSpread({},analysis),{},{messages:messages.filter(msg=>msg.role===\"user\").map(msg=>({content:msg.content,timestamp:msg.timestamp}))}));}catch(error){console.error(\"분석 결과 저장 중 오류:\",error);}}catch(error){console.error(\"채팅 분석 중 오류:\",error);setMessages(prev=>[...prev,{role:\"assistant\",content:\"채팅 분석 중 오류가 발생했습니다. 다시 시도해주세요.\",timestamp:new Date()}]);}finally{setIsCompleting(false);}};const handleKeyPress=e=>{if(e.key===\"Enter\"&&!e.shiftKey){e.preventDefault();handleSendMessage(input);}};// Firebase 인증 체크 제거\nif(!selectedScenario){return/*#__PURE__*/_jsx(ScenarioSelector,{onSelect:setSelectedScenario,character:character});}return/*#__PURE__*/_jsxs(\"div\",{className:styles.root,children:[/*#__PURE__*/_jsxs(\"div\",{className:styles.header,children:[/*#__PURE__*/_jsx(\"button\",{onClick:onBack,className:styles.backBtn,children:\"\\u2190\"}),/*#__PURE__*/_jsx(\"img\",{src:character.imageUrl,alt:character.name,className:styles.avatar}),/*#__PURE__*/_jsx(\"div\",{className:styles.title,children:character.name}),/*#__PURE__*/_jsx(\"button\",{onClick:handleFinishChat,className:\"\".concat(styles.completeBtn,\" \").concat(isCompleting?styles.completing:\"\"),disabled:!chatId||isCompleting,children:isCompleting?\"처리 중...\":\"오답 노트\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:styles.messages,children:[messages.map((msg,idx)=>/*#__PURE__*/_jsx(\"div\",{className:styles[\"bubble\"+(msg.role===\"user\"?\"Me\":\"Other\")],children:msg.content},idx)),loading&&/*#__PURE__*/_jsx(\"div\",{className:styles.bubbleOther,children:/*#__PURE__*/_jsxs(\"div\",{className:styles.typingIndicator,children:[/*#__PURE__*/_jsx(\"div\",{className:styles.typingDot}),/*#__PURE__*/_jsx(\"div\",{className:styles.typingDot}),/*#__PURE__*/_jsx(\"div\",{className:styles.typingDot})]})}),/*#__PURE__*/_jsx(\"div\",{ref:chatEndRef})]}),/*#__PURE__*/_jsxs(\"div\",{className:styles.inputbar,children:[/*#__PURE__*/_jsx(\"input\",{ref:inputRef,id:\"chat-input\",name:\"chat-input\",value:input,onChange:e=>setInput(e.target.value),onKeyDown:handleKeyPress,placeholder:\"\\uB300\\uD654\\uB97C \\uC2DC\\uC791\\uD558\\uC138\\uC694.\",disabled:loading,autoComplete:\"off\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleSendMessage(input),className:styles.sendBtn,disabled:loading||!input.trim(),children:\"\\uC804\\uC1A1\"})]}),showAnalysis&&analysis&&/*#__PURE__*/_jsx(AnalysisModal,{analysis:analysis,onClose:()=>setShowAnalysis(false)})]});}export default ChatRoom;","map":{"version":3,"names":["React","useRef","useEffect","useState","styles","fetchGeminiReply","initializeChatSession","clearChatSession","getConversationHistory","saveChat","updateChatAnalysis","ScenarioSelector","AnalysisModal","jsx","_jsx","jsxs","_jsxs","CEFR_CRITERIA","A1","score","criteria","A2","B1","B2","C1","C2","LEVEL_ADJUSTMENTS","vocab","grammar","sentenceLength","focus","ChatRoom","_ref","character","onBack","messages","setMessages","input","setInput","loading","setLoading","selectedScenario","setSelectedScenario","chatId","setChatId","isCompleting","setIsCompleting","showAnalysis","setShowAnalysis","analysis","setAnalysis","userLevel","setUserLevel","chatEndRef","inputRef","initUserData","console","log","error","removeMarkdown","text","replace","trim","_chatEndRef$current","current","scrollIntoView","behavior","getLevelAdjustedPrompt","basePrompt","level","concat","adjustedPrompt","prompt","id","catch","err","msgs","from","analyzeChat","userMessages","filter","msg","role","map","content","currentLevel","JSON","stringify","response","responseText","jsonMatch","match","Error","parsedAnalysis","parse","corrections","Array","isArray","summary","correctionCount","length","Math","max","_objectSpread","previousCefrLevel","newCefrLevel","e","handleSendMessage","message","newMessage","timestamp","Date","prev","newChatId","cleanResponse","aiMessage","handleFinishChat","handleKeyPress","key","shiftKey","preventDefault","onSelect","className","root","children","header","onClick","backBtn","src","imageUrl","alt","name","avatar","title","completeBtn","completing","disabled","idx","bubbleOther","typingIndicator","typingDot","ref","inputbar","value","onChange","target","onKeyDown","placeholder","autoComplete","sendBtn","onClose"],"sources":["/home/kmean/Desktop/Mobile/term_project/estudy_gpt/web/web_chat/src/components/ChatRoom.js"],"sourcesContent":["// import React, { useRef, useEffect, useState } from \"react\";\n// import styles from \"../styles/ChatRoom.module.css\";\n// import {\n//   fetchGeminiReply,\n//   initializeChatSession,\n//   clearChatSession,\n//   getConversationHistory,\n// } from \"../api/gemini\";\n// import { saveChat, updateChatAnalysis, initializeAuth } from \"../api/firebase\";\n// import ScenarioSelector from \"./ScenarioSelector\";\n// import AnalysisModal from \"./AnalysisModal\";\n// import { auth, db } from \"../firebase/firebaseConfig\";\n// import { get, ref, update } from \"firebase/database\";\n\n// const CEFR_CRITERIA = {\n//   A1: {\n//     score: [0, 30],\n//     criteria: [\n//       \"Can use basic vocabulary and simple phrases\",\n//       \"Can understand and use familiar everyday expressions\",\n//       \"Can introduce themselves and others\",\n//       \"Can ask and answer simple questions about personal details\",\n//     ],\n//   },\n//   A2: {\n//     score: [31, 50],\n//     criteria: [\n//       \"Can communicate in simple and routine tasks\",\n//       \"Can describe in simple terms aspects of their background\",\n//       \"Can handle short social exchanges\",\n//       \"Can understand sentences and frequently used expressions\",\n//     ],\n//   },\n//   B1: {\n//     score: [51, 70],\n//     criteria: [\n//       \"Can deal with most situations likely to arise while traveling\",\n//       \"Can produce simple connected text on familiar topics\",\n//       \"Can describe experiences, events, dreams, and ambitions\",\n//       \"Can give reasons and explanations for opinions and plans\",\n//     ],\n//   },\n//   B2: {\n//     score: [71, 85],\n//     criteria: [\n//       \"Can interact with a degree of fluency and spontaneity\",\n//       \"Can produce clear, detailed text on a wide range of subjects\",\n//       \"Can explain a viewpoint on a topical issue\",\n//       \"Can understand the main ideas of complex text\",\n//     ],\n//   },\n//   C1: {\n//     score: [86, 95],\n//     criteria: [\n//       \"Can express ideas fluently and spontaneously\",\n//       \"Can use language flexibly and effectively for social and professional purposes\",\n//       \"Can produce clear, well-structured, detailed text on complex subjects\",\n//       \"Can understand implicit meaning\",\n//     ],\n//   },\n//   C2: {\n//     score: [96, 100],\n//     criteria: [\n//       \"Can understand with ease virtually everything heard or read\",\n//       \"Can summarize information from different sources\",\n//       \"Can express themselves spontaneously, very fluently and precisely\",\n//       \"Can differentiate finer shades of meaning\",\n//     ],\n//   },\n// };\n\n// const LEVEL_ADJUSTMENTS = {\n//   A1: {\n//     vocab: \"basic (up to 500 words)\",\n//     grammar: \"simple present tense and basic present continuous\",\n//     sentenceLength: \"5-7 words\",\n//     focus: \"concrete, everyday topics\",\n//   },\n//   A2: {\n//     vocab: \"basic (up to 1000 words)\",\n//     grammar: \"simple past and future tenses\",\n//     sentenceLength: \"7-10 words\",\n//     focus: \"familiar topics and daily routines\",\n//   },\n//   B1: {\n//     vocab: \"intermediate (up to 2000 words)\",\n//     grammar: \"various tenses and modal verbs\",\n//     sentenceLength: \"10-15 words\",\n//     focus: \"abstract topics and opinions\",\n//   },\n//   B2: {\n//     vocab: \"advanced (up to 4000 words)\",\n//     grammar: \"complex grammar structures\",\n//     sentenceLength: \"15-20 words\",\n//     focus: \"complex topics and hypothetical situations\",\n//   },\n//   C1: {\n//     vocab: \"sophisticated (up to 8000 words)\",\n//     grammar: \"advanced grammar structures\",\n//     sentenceLength: \"20+ words\",\n//     focus: \"abstract concepts and specialized topics\",\n//   },\n//   C2: {\n//     vocab: \"native-like expressions\",\n//     grammar: \"complex grammar naturally\",\n//     sentenceLength: \"natural length\",\n//     focus: \"any topic with depth and precision\",\n//   },\n// };\n\n// function ChatRoom({ character, onBack }) {\n//   const [messages, setMessages] = useState([]);\n//   const [input, setInput] = useState(\"\");\n//   const [loading, setLoading] = useState(false);\n//   const [selectedScenario, setSelectedScenario] = useState(null);\n//   const [chatId, setChatId] = useState(null);\n//   const [isCompleting, setIsCompleting] = useState(false);\n//   const [showAnalysis, setShowAnalysis] = useState(false);\n//   const [analysis, setAnalysis] = useState(null);\n//   const [userLevel, setUserLevel] = useState(\"A1\");\n//   const [isAuthReady, setIsAuthReady] = useState(false);\n//   const chatEndRef = useRef(null);\n//   const inputRef = useRef(null);\n\n//   useEffect(() => {\n//     const unsubscribe = auth.onAuthStateChanged((user) => {\n//       setIsAuthReady(!!user);\n//       if (user) {\n//         initUserData();\n//       }\n//     });\n\n//     return () => unsubscribe();\n//   }, []);\n\n//   const initUserData = async () => {\n//     try {\n//       if (!auth.currentUser) return;\n\n//       const uid = auth.currentUser.uid;\n//       const userRef = ref(db, `users/${uid}`);\n//       const snapshot = await get(userRef);\n//       if (snapshot.exists()) {\n//         const userData = snapshot.val();\n//         if (userData.cefrLevel) {\n//           setUserLevel(userData.cefrLevel);\n//         }\n//       }\n//     } catch (error) {\n//       console.error(\"사용자 데이터 초기화 중 오류:\", error);\n//     }\n//   };\n\n//   const removeMarkdown = (text) => {\n//     return text\n//       .replace(/\\*\\*(.*?)\\*\\*/g, \"$1\")\n//       .replace(/\\*(.*?)\\*/g, \"$1\")\n//       .replace(/_(.*?)_/g, \"$1\")\n//       .replace(/`(.*?)`/g, \"$1\")\n//       .replace(/\\[(.*?)\\]\\((.*?)\\)/g, \"$1\")\n//       .replace(/\\n/g, \" \")\n//       .replace(/\\s+/g, \" \")\n//       .trim();\n//   };\n\n//   useEffect(() => {\n//     chatEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n//   }, [messages]);\n\n//   useEffect(() => {\n//     if (!loading && inputRef.current) {\n//       inputRef.current.focus();\n//     }\n//   }, [loading, messages]);\n\n//   const getLevelAdjustedPrompt = (basePrompt) => {\n//     const level = LEVEL_ADJUSTMENTS[userLevel];\n//     return `${basePrompt}\\n\\nIMPORTANT: Stay in character while following these guidelines:\n\n// 1. CHARACTER:\n// - Maintain your personality traits and speech patterns\n// - Use your characteristic expressions\n// - Stay consistent with your character's style\n\n// 2. CONVERSATION:\n// - Ask 2-3 follow-up questions per topic\n// - Use questions matching your character's interests\n// - Show curiosity in topics that fit your personality\n// - Ask for details in your character's way\n\n// 3. LANGUAGE (CEFR ${userLevel}):\n// - Use ${level.vocab}\n// - Use ${level.grammar}\n// - Keep sentences ${level.sentenceLength}\n// - Focus on ${level.focus}\n\n// 4. TOPICS:\n// - Discuss topics your character cares about\n// - Share your character's perspective\n// - Ask questions reflecting your character's interests\n// - Build on responses while staying in character\n\n// 5. CORRECTIONS:\n// - Focus on major errors only\n// - Rephrase mistakes while staying in character\n// - Keep the conversation natural\n\n// Goal: Maintain character while helping practice English.`;\n//   };\n\n//   useEffect(() => {\n//     if (selectedScenario) {\n//       const adjustedPrompt = getLevelAdjustedPrompt(selectedScenario.prompt);\n//       initializeChatSession(character.id, adjustedPrompt).catch((err) => {\n//         console.error(\"Failed to initialize chat session:\", err);\n//         setMessages((msgs) => [\n//           ...msgs,\n//           {\n//             from: \"other\",\n//             text: \"채팅 세션을 시작하지 못했어요. 다시 시도해주세요.\",\n//           },\n//         ]);\n//       });\n//     }\n//   }, [selectedScenario, character.id, userLevel]);\n\n//   useEffect(() => {\n//     return () => {\n//       if (character.id) {\n//         clearChatSession(character.id);\n//       }\n//     };\n//   }, [character.id]);\n\n//   const analyzeChat = async (messages) => {\n//     try {\n//       const userMessages = messages\n//         .filter((msg) => msg.role === \"user\")\n//         .map((msg) => msg.content);\n\n//       const uid = auth.currentUser.uid;\n//       const userRef = ref(db, `users/${uid}`);\n//       const snapshot = await get(userRef);\n//       const currentLevel = snapshot.exists() ? snapshot.val().cefrLevel : \"A1\";\n\n//       const prompt = `You are a friendly English conversation partner analyzing a casual chat. Your role is to evaluate the user's English and provide constructive feedback.\n\n//       IMPORTANT GUIDELINES FOR ERROR CORRECTION:\n//       - DO NOT correct casual expressions like \"plz\", \"thx\", \"gonna\", \"wanna\", etc.\n//       - DO NOT mark missing periods or casual capitalization as errors\n//       - DO NOT correct common chat abbreviations or emoticons\n//       - DO NOT correct informal/conversational grammar that native speakers commonly use\n//       - Only correct clear mistakes that affect understanding or are definitely wrong\n//       - Focus on helping them communicate more naturally, not on strict grammar rules\n\n//       IMPORTANT: Respond ONLY with valid JSON, no other text.\n//       Format your response exactly like this:\n//       {\n//         \"corrections\": [\n//           {\n//             \"original\": \"original sentence\",\n//             \"corrected\": \"corrected sentence\",\n//             \"explanation\": \"friendly explanation focusing on natural communication (2 lines max)\"\n//           }\n//         ],\n//         \"summary\": \"encouraging feedback about their communication style and specific areas for improvement (2-3 lines)\"\n//       }\n\n//       Analyze these messages:\n//       ${JSON.stringify(userMessages, null, 2)}`;\n\n//       const response = await fetchGeminiReply(prompt, character.id);\n//       const responseText = await response.text();\n\n//       try {\n//         const jsonMatch = responseText.match(/\\{[\\s\\S]*\\}/);\n//         if (!jsonMatch) {\n//           throw new Error(\"No JSON found in response\");\n//         }\n\n//         const parsedAnalysis = JSON.parse(jsonMatch[0]);\n\n//         if (\n//           !parsedAnalysis.corrections ||\n//           !Array.isArray(parsedAnalysis.corrections)\n//         ) {\n//           throw new Error(\"Invalid corrections format\");\n//         }\n//         if (\n//           !parsedAnalysis.summary ||\n//           typeof parsedAnalysis.summary !== \"string\"\n//         ) {\n//           throw new Error(\"Invalid summary format\");\n//         }\n\n//         const correctionCount = parsedAnalysis.corrections.length;\n//         const score = Math.max(0, 100 - correctionCount * 10);\n\n//         const newLevel = await checkAndUpdateCEFRLevel(score);\n\n//         return {\n//           ...parsedAnalysis,\n//           score,\n//           previousCefrLevel: currentLevel,\n//           newCefrLevel: newLevel,\n//         };\n//       } catch (e) {\n//         console.error(\"Failed to parse analysis response:\", e);\n//         return {\n//           corrections: [],\n//           summary: \"분석 결과를 파싱하는데 실패했습니다. 다시 시도해주세요.\",\n//           score: 0,\n//           previousCefrLevel: currentLevel,\n//           newCefrLevel: currentLevel,\n//         };\n//       }\n//     } catch (error) {\n//       console.error(\"Error analyzing chat:\", error);\n//       throw error;\n//     }\n//   };\n\n//   const checkAndUpdateCEFRLevel = async (score) => {\n//     try {\n//       const uid = auth.currentUser.uid;\n//       const userRef = ref(db, `users/${uid}`);\n//       const snapshot = await get(userRef);\n\n//       if (!snapshot.exists()) return \"A1\";\n\n//       const userData = snapshot.val();\n//       const recentScores = userData.recentScores || [];\n//       const totalSessions = userData.totalSessions || 0;\n\n//       recentScores.push({\n//         score,\n//         timestamp: Date.now(),\n//       });\n\n//       if (recentScores.length > 10) {\n//         recentScores.shift();\n//       }\n\n//       let newLevel = userData.cefrLevel;\n//       const isInitialStage = totalSessions < 20;\n\n//       if (isInitialStage) {\n//         if (userData.cefrLevel === \"A1\") {\n//           const highScores = recentScores.filter((s) => s.score >= 60);\n//           if (highScores.length >= 2) {\n//             newLevel = \"A2\";\n//           }\n//         } else {\n//           const highScores = recentScores.filter((s) => s.score >= 90);\n//           if (highScores.length >= 9) {\n//             newLevel = getNextLevel(userData.cefrLevel);\n//           }\n//           const lowScores = recentScores.filter((s) => s.score <= 50);\n//           if (lowScores.length >= 6) {\n//             newLevel = getPreviousLevel(userData.cefrLevel);\n//           }\n//         }\n//       } else {\n//         const highScores = recentScores.filter((s) => s.score >= 80);\n//         if (highScores.length >= 4) {\n//           newLevel = getNextLevel(userData.cefrLevel);\n//         }\n//         const lowScores = recentScores.filter((s) => s.score <= 60);\n//         if (lowScores.length >= 3) {\n//           newLevel = getPreviousLevel(userData.cefrLevel);\n//         }\n//       }\n\n//       if (newLevel !== userData.cefrLevel) {\n//         await update(userRef, {\n//           cefrLevel: newLevel,\n//           recentScores,\n//           totalSessions: totalSessions + 1,\n//           levelHistory: [\n//             ...(userData.levelHistory || []),\n//             {\n//               level: newLevel,\n//               changedAt: Date.now(),\n//               reason: newLevel > userData.cefrLevel ? \"upgrade\" : \"downgrade\",\n//             },\n//           ],\n//         });\n//       } else {\n//         await update(userRef, {\n//           recentScores,\n//           totalSessions: totalSessions + 1,\n//         });\n//       }\n\n//       return newLevel;\n//     } catch (error) {\n//       console.error(\"Error updating CEFR level:\", error);\n//       return \"A1\";\n//     }\n//   };\n\n//   const getNextLevel = (currentLevel) => {\n//     const levels = [\"A1\", \"A2\", \"B1\", \"B2\", \"C1\", \"C2\"];\n//     const currentIndex = levels.indexOf(currentLevel);\n//     return currentIndex < levels.length - 1\n//       ? levels[currentIndex + 1]\n//       : currentLevel;\n//   };\n\n//   const getPreviousLevel = (currentLevel) => {\n//     const levels = [\"A1\", \"A2\", \"B1\", \"B2\", \"C1\", \"C2\"];\n//     const currentIndex = levels.indexOf(currentLevel);\n//     return currentIndex > 0 ? levels[currentIndex - 1] : currentLevel;\n//   };\n\n//   const handleSendMessage = async (message) => {\n//     if (!message.trim() || !isAuthReady || !auth.currentUser) return;\n\n//     const newMessage = {\n//       role: \"user\",\n//       content: message,\n//       timestamp: new Date(),\n//     };\n\n//     setMessages((prev) => [...prev, newMessage]);\n//     setInput(\"\");\n//     setLoading(true);\n\n//     try {\n//       if (!chatId) {\n//         const newChatId = await saveChat(message, character.id);\n//         setChatId(newChatId);\n//       }\n\n//       const response = await fetchGeminiReply(message, character.id);\n//       const responseText = await response.text();\n//       const cleanResponse = removeMarkdown(responseText);\n\n//       const aiMessage = {\n//         role: \"assistant\",\n//         content: cleanResponse,\n//         timestamp: new Date(),\n//       };\n//       setMessages((prev) => [...prev, aiMessage]);\n//     } catch (error) {\n//       console.error(\"AI 응답 생성 중 오류:\", error);\n//       setMessages((prev) => [\n//         ...prev,\n//         {\n//           role: \"assistant\",\n//           content:\n//             \"죄송합니다. 응답을 생성하는 중에 오류가 발생했습니다. 잠시 후 다시 시도해주세요.\",\n//           timestamp: new Date(),\n//         },\n//       ]);\n//     } finally {\n//       setLoading(false);\n//     }\n//   };\n\n//   const handleFinishChat = async () => {\n//     if (!chatId) return;\n\n//     setIsCompleting(true);\n//     try {\n//       const analysis = await analyzeChat(messages);\n//       setAnalysis(analysis);\n//       setShowAnalysis(true);\n\n//       try {\n//         await updateChatAnalysis(chatId, {\n//           ...analysis,\n//           messages: messages\n//             .filter((msg) => msg.role === \"user\")\n//             .map((msg) => ({\n//               content: msg.content,\n//               timestamp: msg.timestamp,\n//             })),\n//         });\n//       } catch (error) {\n//         console.error(\"분석 결과 저장 중 오류:\", error);\n//       }\n//     } catch (error) {\n//       console.error(\"채팅 분석 중 오류:\", error);\n//       setMessages((prev) => [\n//         ...prev,\n//         {\n//           role: \"assistant\",\n//           content: \"채팅 분석 중 오류가 발생했습니다. 다시 시도해주세요.\",\n//           timestamp: new Date(),\n//         },\n//       ]);\n//     } finally {\n//       setIsCompleting(false);\n//     }\n//   };\n\n//   const handleKeyPress = (e) => {\n//     if (e.key === \"Enter\" && !e.shiftKey) {\n//       e.preventDefault();\n//       handleSendMessage(input);\n//     }\n//   };\n\n//   if (!isAuthReady) {\n//     return (\n//       <div className={styles.loadingContainer}>\n//         <div className={styles.loadingSpinner} />\n//       </div>\n//     );\n//   }\n\n//   if (!selectedScenario) {\n//     return (\n//       <ScenarioSelector onSelect={setSelectedScenario} character={character} />\n//     );\n//   }\n\n//   return (\n//     <div className={styles.root}>\n//       <div className={styles.header}>\n//         <button onClick={onBack} className={styles.backBtn}>\n//           ←\n//         </button>\n//         <img\n//           src={character.imageUrl}\n//           alt={character.name}\n//           className={styles.avatar}\n//         />\n//         <div className={styles.title}>{character.name}</div>\n//         <button\n//           onClick={handleFinishChat}\n//           className={`${styles.completeBtn} ${\n//             isCompleting ? styles.completing : \"\"\n//           }`}\n//           disabled={!chatId || isCompleting}\n//         >\n//           {isCompleting ? \"처리 중...\" : \"오답 노트\"}\n//         </button>\n//       </div>\n//       <div className={styles.messages}>\n//         {messages.map((msg, idx) => (\n//           <div\n//             key={idx}\n//             className={\n//               styles[\"bubble\" + (msg.role === \"user\" ? \"Me\" : \"Other\")]\n//             }\n//           >\n//             {msg.content}\n//           </div>\n//         ))}\n//         {loading && (\n//           <div className={styles.bubbleOther}>\n//             <div className={styles.typingIndicator}>\n//               <div className={styles.typingDot} />\n//               <div className={styles.typingDot} />\n//               <div className={styles.typingDot} />\n//             </div>\n//           </div>\n//         )}\n//         <div ref={chatEndRef} />\n//       </div>\n//       <div className={styles.inputbar}>\n//         <input\n//           ref={inputRef}\n//           id=\"chat-input\"\n//           name=\"chat-input\"\n//           value={input}\n//           onChange={(e) => setInput(e.target.value)}\n//           onKeyDown={handleKeyPress}\n//           placeholder=\"대화를 시작하세요.\"\n//           disabled={loading}\n//           autoComplete=\"off\"\n//         />\n//         <button\n//           onClick={() => handleSendMessage(input)}\n//           className={styles.sendBtn}\n//           disabled={loading || !input.trim()}\n//         >\n//           전송\n//         </button>\n//       </div>\n//       {showAnalysis && analysis && (\n//         <AnalysisModal\n//           analysis={analysis}\n//           onClose={() => setShowAnalysis(false)}\n//         />\n//       )}\n//     </div>\n//   );\n// }\n\n// export default ChatRoom;\n\nimport React, { useRef, useEffect, useState } from \"react\";\nimport styles from \"../styles/ChatRoom.module.css\";\nimport {\n  fetchGeminiReply,\n  initializeChatSession,\n  clearChatSession,\n  getConversationHistory,\n} from \"../api/gemini\";\nimport { saveChat, updateChatAnalysis } from \"../api/firebase\";\nimport ScenarioSelector from \"./ScenarioSelector\";\nimport AnalysisModal from \"./AnalysisModal\";\n\nconst CEFR_CRITERIA = {\n  A1: {\n    score: [0, 30],\n    criteria: [\n      \"Can use basic vocabulary and simple phrases\",\n      \"Can understand and use familiar everyday expressions\",\n      \"Can introduce themselves and others\",\n      \"Can ask and answer simple questions about personal details\",\n    ],\n  },\n  A2: {\n    score: [31, 50],\n    criteria: [\n      \"Can communicate in simple and routine tasks\",\n      \"Can describe in simple terms aspects of their background\",\n      \"Can handle short social exchanges\",\n      \"Can understand sentences and frequently used expressions\",\n    ],\n  },\n  B1: {\n    score: [51, 70],\n    criteria: [\n      \"Can deal with most situations likely to arise while traveling\",\n      \"Can produce simple connected text on familiar topics\",\n      \"Can describe experiences, events, dreams, and ambitions\",\n      \"Can give reasons and explanations for opinions and plans\",\n    ],\n  },\n  B2: {\n    score: [71, 85],\n    criteria: [\n      \"Can interact with a degree of fluency and spontaneity\",\n      \"Can produce clear, detailed text on a wide range of subjects\",\n      \"Can explain a viewpoint on a topical issue\",\n      \"Can understand the main ideas of complex text\",\n    ],\n  },\n  C1: {\n    score: [86, 95],\n    criteria: [\n      \"Can express ideas fluently and spontaneously\",\n      \"Can use language flexibly and effectively for social and professional purposes\",\n      \"Can produce clear, well-structured, detailed text on complex subjects\",\n      \"Can understand implicit meaning\",\n    ],\n  },\n  C2: {\n    score: [96, 100],\n    criteria: [\n      \"Can understand with ease virtually everything heard or read\",\n      \"Can summarize information from different sources\",\n      \"Can express themselves spontaneously, very fluently and precisely\",\n      \"Can differentiate finer shades of meaning\",\n    ],\n  },\n};\n\nconst LEVEL_ADJUSTMENTS = {\n  A1: {\n    vocab: \"basic (up to 500 words)\",\n    grammar: \"simple present tense and basic present continuous\",\n    sentenceLength: \"5-7 words\",\n    focus: \"concrete, everyday topics\",\n  },\n  A2: {\n    vocab: \"basic (up to 1000 words)\",\n    grammar: \"simple past and future tenses\",\n    sentenceLength: \"7-10 words\",\n    focus: \"familiar topics and daily routines\",\n  },\n  B1: {\n    vocab: \"intermediate (up to 2000 words)\",\n    grammar: \"various tenses and modal verbs\",\n    sentenceLength: \"10-15 words\",\n    focus: \"abstract topics and opinions\",\n  },\n  B2: {\n    vocab: \"advanced (up to 4000 words)\",\n    grammar: \"complex grammar structures\",\n    sentenceLength: \"15-20 words\",\n    focus: \"complex topics and hypothetical situations\",\n  },\n  C1: {\n    vocab: \"sophisticated (up to 8000 words)\",\n    grammar: \"advanced grammar structures\",\n    sentenceLength: \"20+ words\",\n    focus: \"abstract concepts and specialized topics\",\n  },\n  C2: {\n    vocab: \"native-like expressions\",\n    grammar: \"complex grammar naturally\",\n    sentenceLength: \"natural length\",\n    focus: \"any topic with depth and precision\",\n  },\n};\n\nfunction ChatRoom({ character, onBack }) {\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState(\"\");\n  const [loading, setLoading] = useState(false);\n  const [selectedScenario, setSelectedScenario] = useState(null);\n  const [chatId, setChatId] = useState(null);\n  const [isCompleting, setIsCompleting] = useState(false);\n  const [showAnalysis, setShowAnalysis] = useState(false);\n  const [analysis, setAnalysis] = useState(null);\n  const [userLevel, setUserLevel] = useState(\"A1\");\n  const chatEndRef = useRef(null);\n  const inputRef = useRef(null);\n\n  // Firebase 인증 제거하고 기본 초기화\n  useEffect(() => {\n    initUserData();\n  }, []);\n\n  const initUserData = async () => {\n    try {\n      // Flutter uid 기반으로 작동하므로 기본값 설정\n      setUserLevel(\"A1\");\n      console.log(\"User data initialized with default level: A1\");\n    } catch (error) {\n      console.error(\"사용자 데이터 초기화 중 오류:\", error);\n    }\n  };\n\n  const removeMarkdown = (text) => {\n    return text\n      .replace(/\\*\\*(.*?)\\*\\*/g, \"$1\")\n      .replace(/\\*(.*?)\\*/g, \"$1\")\n      .replace(/_(.*?)_/g, \"$1\")\n      .replace(/`(.*?)`/g, \"$1\")\n      .replace(/\\[(.*?)\\]\\((.*?)\\)/g, \"$1\")\n      .replace(/\\n/g, \" \")\n      .replace(/\\s+/g, \" \")\n      .trim();\n  };\n\n  useEffect(() => {\n    chatEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  useEffect(() => {\n    if (!loading && inputRef.current) {\n      inputRef.current.focus();\n    }\n  }, [loading, messages]);\n\n  const getLevelAdjustedPrompt = (basePrompt) => {\n    const level = LEVEL_ADJUSTMENTS[userLevel];\n    return `${basePrompt}\\n\\nIMPORTANT: Stay in character while following these guidelines:\n\n1. CHARACTER:\n- Maintain your personality traits and speech patterns\n- Use your characteristic expressions\n- Stay consistent with your character's style\n\n2. CONVERSATION:\n- Ask 2-3 follow-up questions per topic\n- Use questions matching your character's interests\n- Show curiosity in topics that fit your personality\n- Ask for details in your character's way\n\n3. LANGUAGE (CEFR ${userLevel}):\n- Use ${level.vocab}\n- Use ${level.grammar}\n- Keep sentences ${level.sentenceLength}\n- Focus on ${level.focus}\n\n4. TOPICS:\n- Discuss topics your character cares about\n- Share your character's perspective\n- Ask questions reflecting your character's interests\n- Build on responses while staying in character\n\n5. CORRECTIONS:\n- Focus on major errors only\n- Rephrase mistakes while staying in character\n- Keep the conversation natural\n\nGoal: Maintain character while helping practice English.`;\n  };\n\n  useEffect(() => {\n    if (selectedScenario) {\n      const adjustedPrompt = getLevelAdjustedPrompt(selectedScenario.prompt);\n      initializeChatSession(character.id, adjustedPrompt).catch((err) => {\n        console.error(\"Failed to initialize chat session:\", err);\n        setMessages((msgs) => [\n          ...msgs,\n          {\n            from: \"other\",\n            text: \"채팅 세션을 시작하지 못했어요. 다시 시도해주세요.\",\n          },\n        ]);\n      });\n    }\n  }, [selectedScenario, character.id, userLevel]);\n\n  useEffect(() => {\n    return () => {\n      if (character.id) {\n        clearChatSession(character.id);\n      }\n    };\n  }, [character.id]);\n\n  const analyzeChat = async (messages) => {\n    try {\n      const userMessages = messages\n        .filter((msg) => msg.role === \"user\")\n        .map((msg) => msg.content);\n\n      // Firebase 사용자 데이터 조회 제거하고 기본값 사용\n      const currentLevel = userLevel || \"A1\";\n\n      const prompt = `You are a friendly English conversation partner analyzing a casual chat. Your role is to evaluate the user's English and provide constructive feedback.\n\n      IMPORTANT GUIDELINES FOR ERROR CORRECTION:\n      - DO NOT correct casual expressions like \"plz\", \"thx\", \"gonna\", \"wanna\", etc.\n      - DO NOT mark missing periods or casual capitalization as errors\n      - DO NOT correct common chat abbreviations or emoticons\n      - DO NOT correct informal/conversational grammar that native speakers commonly use\n      - Only correct clear mistakes that affect understanding or are definitely wrong\n      - Focus on helping them communicate more naturally, not on strict grammar rules\n\n      IMPORTANT: Respond ONLY with valid JSON, no other text.\n      Format your response exactly like this:\n      {\n        \"corrections\": [\n          {\n            \"original\": \"original sentence\",\n            \"corrected\": \"corrected sentence\",\n            \"explanation\": \"friendly explanation focusing on natural communication (2 lines max)\"\n          }\n        ],\n        \"summary\": \"encouraging feedback about their communication style and specific areas for improvement (2-3 lines)\"\n      }\n\n      Analyze these messages:\n      ${JSON.stringify(userMessages, null, 2)}`;\n\n      const response = await fetchGeminiReply(prompt, character.id);\n      const responseText = await response.text();\n\n      try {\n        const jsonMatch = responseText.match(/\\{[\\s\\S]*\\}/);\n        if (!jsonMatch) {\n          throw new Error(\"No JSON found in response\");\n        }\n\n        const parsedAnalysis = JSON.parse(jsonMatch[0]);\n\n        if (\n          !parsedAnalysis.corrections ||\n          !Array.isArray(parsedAnalysis.corrections)\n        ) {\n          throw new Error(\"Invalid corrections format\");\n        }\n        if (\n          !parsedAnalysis.summary ||\n          typeof parsedAnalysis.summary !== \"string\"\n        ) {\n          throw new Error(\"Invalid summary format\");\n        }\n\n        const correctionCount = parsedAnalysis.corrections.length;\n        const score = Math.max(0, 100 - correctionCount * 10);\n\n        return {\n          ...parsedAnalysis,\n          score,\n          previousCefrLevel: currentLevel,\n          newCefrLevel: currentLevel, // 레벨 업데이트 제거\n        };\n      } catch (e) {\n        console.error(\"Failed to parse analysis response:\", e);\n        return {\n          corrections: [],\n          summary: \"분석 결과를 파싱하는데 실패했습니다. 다시 시도해주세요.\",\n          score: 0,\n          previousCefrLevel: currentLevel,\n          newCefrLevel: currentLevel,\n        };\n      }\n    } catch (error) {\n      console.error(\"Error analyzing chat:\", error);\n      throw error;\n    }\n  };\n\n  const handleSendMessage = async (message) => {\n    if (!message.trim()) return; // Firebase 인증 체크 제거\n\n    const newMessage = {\n      role: \"user\",\n      content: message,\n      timestamp: new Date(),\n    };\n\n    setMessages((prev) => [...prev, newMessage]);\n    setInput(\"\");\n    setLoading(true);\n\n    try {\n      // Flutter uid 기반으로 채팅 저장\n      if (!chatId) {\n        const newChatId = await saveChat(message, character.id);\n        setChatId(newChatId);\n      }\n\n      const response = await fetchGeminiReply(message, character.id);\n      const responseText = await response.text();\n      const cleanResponse = removeMarkdown(responseText);\n\n      const aiMessage = {\n        role: \"assistant\",\n        content: cleanResponse,\n        timestamp: new Date(),\n      };\n      setMessages((prev) => [...prev, aiMessage]);\n    } catch (error) {\n      console.error(\"AI 응답 생성 중 오류:\", error);\n      setMessages((prev) => [\n        ...prev,\n        {\n          role: \"assistant\",\n          content:\n            \"죄송합니다. 응답을 생성하는 중에 오류가 발생했습니다. 잠시 후 다시 시도해주세요.\",\n          timestamp: new Date(),\n        },\n      ]);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleFinishChat = async () => {\n    if (!chatId) return;\n\n    setIsCompleting(true);\n    try {\n      const analysis = await analyzeChat(messages);\n      setAnalysis(analysis);\n      setShowAnalysis(true);\n\n      // Flutter uid 기반으로 분석 결과 저장\n      try {\n        await updateChatAnalysis(chatId, {\n          ...analysis,\n          messages: messages\n            .filter((msg) => msg.role === \"user\")\n            .map((msg) => ({\n              content: msg.content,\n              timestamp: msg.timestamp,\n            })),\n        });\n      } catch (error) {\n        console.error(\"분석 결과 저장 중 오류:\", error);\n      }\n    } catch (error) {\n      console.error(\"채팅 분석 중 오류:\", error);\n      setMessages((prev) => [\n        ...prev,\n        {\n          role: \"assistant\",\n          content: \"채팅 분석 중 오류가 발생했습니다. 다시 시도해주세요.\",\n          timestamp: new Date(),\n        },\n      ]);\n    } finally {\n      setIsCompleting(false);\n    }\n  };\n\n  const handleKeyPress = (e) => {\n    if (e.key === \"Enter\" && !e.shiftKey) {\n      e.preventDefault();\n      handleSendMessage(input);\n    }\n  };\n\n  // Firebase 인증 체크 제거\n  if (!selectedScenario) {\n    return (\n      <ScenarioSelector onSelect={setSelectedScenario} character={character} />\n    );\n  }\n\n  return (\n    <div className={styles.root}>\n      <div className={styles.header}>\n        <button onClick={onBack} className={styles.backBtn}>\n          ←\n        </button>\n        <img\n          src={character.imageUrl}\n          alt={character.name}\n          className={styles.avatar}\n        />\n        <div className={styles.title}>{character.name}</div>\n        <button\n          onClick={handleFinishChat}\n          className={`${styles.completeBtn} ${\n            isCompleting ? styles.completing : \"\"\n          }`}\n          disabled={!chatId || isCompleting}\n        >\n          {isCompleting ? \"처리 중...\" : \"오답 노트\"}\n        </button>\n      </div>\n      <div className={styles.messages}>\n        {messages.map((msg, idx) => (\n          <div\n            key={idx}\n            className={\n              styles[\"bubble\" + (msg.role === \"user\" ? \"Me\" : \"Other\")]\n            }\n          >\n            {msg.content}\n          </div>\n        ))}\n        {loading && (\n          <div className={styles.bubbleOther}>\n            <div className={styles.typingIndicator}>\n              <div className={styles.typingDot} />\n              <div className={styles.typingDot} />\n              <div className={styles.typingDot} />\n            </div>\n          </div>\n        )}\n        <div ref={chatEndRef} />\n      </div>\n      <div className={styles.inputbar}>\n        <input\n          ref={inputRef}\n          id=\"chat-input\"\n          name=\"chat-input\"\n          value={input}\n          onChange={(e) => setInput(e.target.value)}\n          onKeyDown={handleKeyPress}\n          placeholder=\"대화를 시작하세요.\"\n          disabled={loading}\n          autoComplete=\"off\"\n        />\n        <button\n          onClick={() => handleSendMessage(input)}\n          className={styles.sendBtn}\n          disabled={loading || !input.trim()}\n        >\n          전송\n        </button>\n      </div>\n      {showAnalysis && analysis && (\n        <AnalysisModal\n          analysis={analysis}\n          onClose={() => setShowAnalysis(false)}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default ChatRoom;\n"],"mappings":"oJAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}