{"ast":null,"code":"import { initializeApp } from \"firebase/app\";\nimport { getDatabase, ref, push, set, get } from \"firebase/database\";\nimport { getAuth, signInAnonymously } from \"firebase/auth\";\nconst firebaseConfig = {\n  apiKey: process.env.REACT_APP_FIREBASE_API_KEY,\n  authDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,\n  databaseURL: process.env.REACT_APP_FIREBASE_DATABASE_URL,\n  projectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,\n  storageBucket: process.env.REACT_APP_FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,\n  appId: process.env.REACT_APP_FIREBASE_APP_ID,\n  measurementId: process.env.REACT_APP_FIREBASE_MEASUREMENT_ID\n};\nconst app = initializeApp(firebaseConfig);\nconst db = getDatabase(app);\nconst auth = getAuth(app);\nexport const initializeAuth = async () => {\n  try {\n    const userCredential = await signInAnonymously(auth);\n    const uid = userCredential.user.uid;\n    const userRef = ref(db, `users/${uid}`);\n    const snapshot = await get(userRef);\n    if (!snapshot.exists()) {\n      await set(userRef, {\n        cefrLevel: \"A1\",\n        createdAt: Date.now(),\n        totalSessions: 0,\n        recentScores: []\n      });\n    }\n    return uid;\n  } catch (error) {\n    console.error(\"Error initializing anonymous auth:\", error);\n    throw error;\n  }\n};\nexport const saveChat = async (message, characterId) => {\n  try {\n    const uid = auth.currentUser.uid;\n    const chatRef = ref(db, `users/${uid}/chat/Conversation`);\n    const newChatRef = push(chatRef);\n    await set(newChatRef, {\n      role: \"user\",\n      content: message,\n      characterId,\n      timestamp: Date.now()\n    });\n    return newChatRef.key;\n  } catch (error) {\n    console.error(\"Error saving chat:\", error.message);\n    throw error;\n  }\n};\n\n//추후 오답노트 기록 불러올 일 생기면 사용할 함수\nexport const getChatsByUser = async () => {\n  try {\n    const uid = auth.currentUser.uid;\n    const chatRef = ref(db, `users/${uid}/chat/Conversation`);\n    const snapshot = await get(chatRef);\n    if (snapshot.exists()) {\n      const chats = [];\n      snapshot.forEach(childSnapshot => {\n        chats.push({\n          id: childSnapshot.key,\n          ...childSnapshot.val()\n        });\n      });\n      return chats;\n    }\n    return [];\n  } catch (error) {\n    console.error(\"Error retrieving chats:\", error.message);\n    throw error;\n  }\n};\nexport const updateChatAnalysis = async (chatId, analysis) => {\n  try {\n    const uid = auth.currentUser.uid;\n    const analysisRef = ref(db, `users/${uid}/wrongNote/${chatId}`);\n    const now = new Date();\n    await set(analysisRef, {\n      ...analysis,\n      analyzedAt: now.toISOString()\n    });\n  } catch (error) {\n    console.error(\"Error updating chat analysis:\", error.message);\n    throw error;\n  }\n};","map":{"version":3,"names":["initializeApp","getDatabase","ref","push","set","get","getAuth","signInAnonymously","firebaseConfig","apiKey","process","env","REACT_APP_FIREBASE_API_KEY","authDomain","REACT_APP_FIREBASE_AUTH_DOMAIN","databaseURL","REACT_APP_FIREBASE_DATABASE_URL","projectId","REACT_APP_FIREBASE_PROJECT_ID","storageBucket","REACT_APP_FIREBASE_STORAGE_BUCKET","messagingSenderId","REACT_APP_FIREBASE_MESSAGING_SENDER_ID","appId","REACT_APP_FIREBASE_APP_ID","measurementId","REACT_APP_FIREBASE_MEASUREMENT_ID","app","db","auth","initializeAuth","userCredential","uid","user","userRef","snapshot","exists","cefrLevel","createdAt","Date","now","totalSessions","recentScores","error","console","saveChat","message","characterId","currentUser","chatRef","newChatRef","role","content","timestamp","key","getChatsByUser","chats","forEach","childSnapshot","id","val","updateChatAnalysis","chatId","analysis","analysisRef","analyzedAt","toISOString"],"sources":["/home/kmean/Desktop/Mobile/term_project/estudy_gpt/web/web_chat/src/api/firebase.js"],"sourcesContent":["import { initializeApp } from \"firebase/app\";\nimport { getDatabase, ref, push, set, get } from \"firebase/database\";\nimport { getAuth, signInAnonymously } from \"firebase/auth\";\n\nconst firebaseConfig = {\n  apiKey: process.env.REACT_APP_FIREBASE_API_KEY,\n  authDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,\n  databaseURL: process.env.REACT_APP_FIREBASE_DATABASE_URL,\n  projectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,\n  storageBucket: process.env.REACT_APP_FIREBASE_STORAGE_BUCKET,\n  messagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,\n  appId: process.env.REACT_APP_FIREBASE_APP_ID,\n  measurementId: process.env.REACT_APP_FIREBASE_MEASUREMENT_ID,\n};\n\nconst app = initializeApp(firebaseConfig);\nconst db = getDatabase(app);\nconst auth = getAuth(app);\n\nexport const initializeAuth = async () => {\n  try {\n    const userCredential = await signInAnonymously(auth);\n    const uid = userCredential.user.uid;\n\n    const userRef = ref(db, `users/${uid}`);\n    const snapshot = await get(userRef);\n\n    if (!snapshot.exists()) {\n      await set(userRef, {\n        cefrLevel: \"A1\",\n        createdAt: Date.now(),\n        totalSessions: 0,\n        recentScores: [],\n      });\n    }\n\n    return uid;\n  } catch (error) {\n    console.error(\"Error initializing anonymous auth:\", error);\n    throw error;\n  }\n};\n\nexport const saveChat = async (message, characterId) => {\n  try {\n    const uid = auth.currentUser.uid;\n    const chatRef = ref(db, `users/${uid}/chat/Conversation`);\n    const newChatRef = push(chatRef);\n\n    await set(newChatRef, {\n      role: \"user\",\n      content: message,\n      characterId,\n      timestamp: Date.now(),\n    });\n\n    return newChatRef.key;\n  } catch (error) {\n    console.error(\"Error saving chat:\", error.message);\n    throw error;\n  }\n};\n\n//추후 오답노트 기록 불러올 일 생기면 사용할 함수\nexport const getChatsByUser = async () => {\n  try {\n    const uid = auth.currentUser.uid;\n    const chatRef = ref(db, `users/${uid}/chat/Conversation`);\n    const snapshot = await get(chatRef);\n\n    if (snapshot.exists()) {\n      const chats = [];\n      snapshot.forEach((childSnapshot) => {\n        chats.push({\n          id: childSnapshot.key,\n          ...childSnapshot.val(),\n        });\n      });\n      return chats;\n    }\n    return [];\n  } catch (error) {\n    console.error(\"Error retrieving chats:\", error.message);\n    throw error;\n  }\n};\n\nexport const updateChatAnalysis = async (chatId, analysis) => {\n  try {\n    const uid = auth.currentUser.uid;\n    const analysisRef = ref(db, `users/${uid}/wrongNote/${chatId}`);\n    const now = new Date();\n    await set(analysisRef, {\n      ...analysis,\n      analyzedAt: now.toISOString(),\n    });\n  } catch (error) {\n    console.error(\"Error updating chat analysis:\", error.message);\n    throw error;\n  }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}